{"version":"1.0","id":"ec3a0aaa-5a28-4934-a5a4-91fe44bba410","name":"NSQL Spark Typed Read","permissions":"Owner","cells":[{"id":"13c0fae8-a9b3-4a82-870d-f6f665f95a93","name":"Insert","language":"lua","code":"local nsQL = require(\"nsQL\")\n\n\t\t\t\t\tfunction main()\n   \t\t\t\t \tlocal query = [[ INSERT INTO nssim.sampledata (ip,floatvalue,datevalue,createdtime,json,rowid,id,numvalue,varintvalue,maxvalue,money,timevalue) VALUES ( '127.0.0.1',3.1415,'2049-03-04','2017-06-05 12:00:05','\n\t\t[\n\t\t  \t\t{\n\t\t  \t\t\t\"name\": \"brians-bucket\",\n\t\t  \t\t\t\"creationDate\": \"2017-05-31T21:07:44.111Z\"\n\t\t  \t\t},\n\t\t  \t\t{\n\t\t  \t\t\t\"name\": \"test-bucket\",\n\t\t  \t\t\t\"creationDate\": \"2017-05-31T21:06:57.76Z\"\n\t\t  \t\t}\n\t\t  ]\n\t\t','a27a5558-f0e2-46aa-a0b1-d28a1bace463','a27a5558-f0e2-46aa-a0b1-d28a1bace463',2017,662607,922337203685,99.99,'00:19:05');]]\n       \t\t\t\t \tlocal source = {\n       \t\t\t\t \t    Protocol = \"cassandra\",\n        \t\t\t\t \t   Host = \"cassandra1-dev2-northstar.mon-marathon-service.mesos,cassandra2-dev2-northstar.mon-marathon-service.mesos,cassandra3-dev2-northstar.mon-marathon-service.mesos,cassandra4-dev2-northstar.mon-marathon-service.mesos,cassandra5-dev2-northstar.mon-marathon-service.mesos\",\n         \t\t\t\t \t  Port = \"31814\",\n          \t\t\t\t \t Backend = \"native\"\n      \t\t\t\t \t }\n      \t\t\t\t \t processQuery(query, source, {})\n   \t\t\t\t \tend\n\n   \t\t\t\t \tfunction processQuery(query, source, options)\n    \t\t\t\t \t   local resp, err = nsQL.query(query, source, options)\n     \t\t\t\t \t  if(err ~= nil) then\n      \t\t\t\t \t     error(err)\n      \t\t\t\t \t end\n      \t\t\t\t \t return resp\n   \t\t\t\t \tend","output":{"lastExecution":"0001-01-01T00:00:00Z","state":"Unknown","results":{"type":"","content":null}},"options":{"showCode":true,"showOutput":true,"timeout":180,"mainFunction":"main","visualization":{"parameters":null},"status":"","showConfiguration":true}},{"id":"f180c35e-2e1b-4f25-8f95-cd2c1859bf64","name":"Select","language":"lua","code":"local nsQL = require(\"nsQL\")\n\t\t\t\tlocal nsOutput = require(\"nsOutput\")\n\n\t\t\t\tfunction main()\n    \t\t\t\tlocal query = [[\n    \t\t\t\t    SELECT  *\n    \t\t\t\t    FROM    nssim.sampledata\n    \t\t\t\t    WHERE   rowid = `a27a5558-f0e2-46aa-a0b1-d28a1bace463` and id='a27a5558-f0e2-46aa-a0b1-d28a1bace463';\n    \t\t\t\t]]\n    \t\t\t\tlocal source = {\n    \t\t\t\t    Protocol = \"cassandra\",\n    \t\t\t\t    Host = \"cassandra1-dev2-northstar.mon-marathon-service.mesos,cassandra2-dev2-northstar.mon-marathon-service.mesos,cassandra3-dev2-northstar.mon-marathon-service.mesos,cassandra4-dev2-northstar.mon-marathon-service.mesos,cassandra5-dev2-northstar.mon-marathon-service.mesos\",\n  \t\t\t\t\t\tPort = \"31814\",\n     \t\t\t\t    Backend = \"spark\"\n    \t\t\t\t}\n    \t\t\t\tlocal result = processQuery(query, source, { ReturnTyped=true})\n    \t\t\t\treturn generateTable(result)\n\t\t\t\tend\n\n\t\t\t\tfunction processQuery(query, source, options)\n   \t\t\t\t local resp, err = nsQL.query(query, source, options)\n   \t\t\t\t if(err ~= nil) then\n   \t\t\t\t     error(err)\n   \t\t\t\t end\n   \t\t\t\t return resp\n\t\t\t\tend\n\n\t\t\t\tfunction generateTable(table)\n \t\t\t\t   local out, err = nsOutput.table(table)\n \t\t\t\t   if(err ~= nil) then\n \t\t\t\t       error(err)\n \t\t\t\t   end\n  \t\t\t\t  return out\n\t\t\t\tend","output":{"lastExecution":"0001-01-01T00:00:00Z","state":"Unknown","results":{"type":"","content":null}},"options":{"showCode":true,"showOutput":true,"timeout":180,"mainFunction":"main","visualization":{"parameters":null},"status":"","showConfiguration":true}},{"id":"24d03ad3-b40d-4319-9d60-2e3db81befe9","name":"Delete","language":"lua","code":"local nsQL = require(\"nsQL\")\n\n\t\t\t\tfunction main()\n    \t\t\t\tlocal query = [[\n \t\t\t\t       DELETE\n \t\t\t\t        FROM    nssim.sampledata\n \t\t\t\t       WHERE   rowid = `a27a5558-f0e2-46aa-a0b1-d28a1bace463` and id='a27a5558-f0e2-46aa-a0b1-d28a1bace463';\n \t\t\t\t   ]]\n \t\t\t\t   local source = {\n \t\t\t\t      Protocol = \"cassandra\",\n        \t\t\t  Host = \"cassandra1-dev2-northstar.mon-marathon-service.mesos,cassandra2-dev2-northstar.mon-marathon-service.mesos,cassandra3-dev2-northstar.mon-marathon-service.mesos,cassandra4-dev2-northstar.mon-marathon-service.mesos,cassandra5-dev2-northstar.mon-marathon-service.mesos\",\n  \t\t\t\t      Port = \"31814\",\n  \t\t\t\t      Backend = \"native\"\n  \t\t\t\t  }\n  \t\t\t\t  processQuery(query, source, {})\n\t\t\t\tend\n\n\t\t\t\tfunction processQuery(query, source, options)\n \t\t\t\t   local resp, err = nsQL.query(query, source, options)\n \t\t\t\t   if(err ~= nil) then\n \t\t\t\t       error(err)\n \t\t\t\t   end\n \t\t\t\t   return resp\n\t\t\t\tend","output":{"lastExecution":"0001-01-01T00:00:00Z","state":"Unknown","results":{"type":"","content":null}},"options":{"showCode":true,"showOutput":true,"timeout":180,"mainFunction":"main","visualization":{"parameters":null},"status":"","showConfiguration":true}}]}
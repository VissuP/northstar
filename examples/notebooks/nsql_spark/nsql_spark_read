{"version":"1.0","id":"6974bf86-8e0f-472e-983c-da1f331ac32c","name":"NSQL Spark Read","permissions":"Owner","cells":[{"id":"7fbaee8b-8a9b-431d-b305-ab9c689d6773","name":"Insert","language":"lua","code":"local nsQL = require(\"nsQL\")\n\n\t\t\t\t\tfunction main()\n   \t\t\t\t \tlocal query = [[ INSERT INTO nssim.sampledata (ip,floatvalue,money,datevalue,rowid,id,numvalue,varintvalue,json,maxvalue,timevalue,createdtime) VALUES ( '127.0.0.1',3.1415,99.99,'2049-03-04','ba43698b-8ee3-44fe-9cbc-c66c75f7df59','ba43698b-8ee3-44fe-9cbc-c66c75f7df59',2017,662607,'\n\t\t[\n\t\t  \t\t{\n\t\t  \t\t\t\"name\": \"brians-bucket\",\n\t\t  \t\t\t\"creationDate\": \"2017-05-31T21:07:44.111Z\"\n\t\t  \t\t},\n\t\t  \t\t{\n\t\t  \t\t\t\"name\": \"test-bucket\",\n\t\t  \t\t\t\"creationDate\": \"2017-05-31T21:06:57.76Z\"\n\t\t  \t\t}\n\t\t  ]\n\t\t',9223372036854775807,'00:19:05','2017-06-05 12:00:05');]]\n       \t\t\t\t \tlocal source = {\n       \t\t\t\t \t    Protocol = \"cassandra\",\n        \t\t\t\t \t   Host = \"cassandra1-dev2-northstar.mon-marathon-service.mesos,cassandra2-dev2-northstar.mon-marathon-service.mesos,cassandra3-dev2-northstar.mon-marathon-service.mesos,cassandra4-dev2-northstar.mon-marathon-service.mesos,cassandra5-dev2-northstar.mon-marathon-service.mesos\",\n         \t\t\t\t \t  Port = \"31814\",\n          \t\t\t\t \t Backend = \"native\"\n      \t\t\t\t \t }\n      \t\t\t\t \t processQuery(query, source, {})\n   \t\t\t\t \tend\n\n   \t\t\t\t \tfunction processQuery(query, source, options)\n    \t\t\t\t \t   local resp, err = nsQL.query(query, source, options)\n     \t\t\t\t \t  if(err ~= nil) then\n      \t\t\t\t \t     error(err)\n      \t\t\t\t \t end\n      \t\t\t\t \t return resp\n   \t\t\t\t \tend","output":{"lastExecution":"0001-01-01T00:00:00Z","state":"Unknown","results":{"type":"","content":null}},"options":{"showCode":true,"showOutput":true,"timeout":180,"mainFunction":"main","visualization":{"parameters":null},"status":"","showConfiguration":true}},{"id":"393d3cf1-de63-47ab-8d49-f192797f0e93","name":"Select","language":"lua","code":"local nsQL = require(\"nsQL\")\n\t\t\t\tlocal nsOutput = require(\"nsOutput\")\n\n\t\t\t\tfunction main()\n    \t\t\t\tlocal query = [[\n    \t\t\t\t    SELECT  *\n    \t\t\t\t    FROM    nssim.sampledata\n    \t\t\t\t    WHERE   rowid = `ba43698b-8ee3-44fe-9cbc-c66c75f7df59` and id='ba43698b-8ee3-44fe-9cbc-c66c75f7df59';\n    \t\t\t\t]]\n    \t\t\t\tlocal source = {\n    \t\t\t\t    Protocol = \"cassandra\",\n    \t\t\t\t    Host = \"cassandra1-dev2-northstar.mon-marathon-service.mesos,cassandra2-dev2-northstar.mon-marathon-service.mesos,cassandra3-dev2-northstar.mon-marathon-service.mesos,cassandra4-dev2-northstar.mon-marathon-service.mesos,cassandra5-dev2-northstar.mon-marathon-service.mesos\",\n  \t\t\t\t\t\tPort = \"31814\",\n     \t\t\t\t    Backend = \"spark\"\n    \t\t\t\t}\n    \t\t\t\tlocal result = processQuery(query, source, { })\n    \t\t\t\treturn generateTable(result)\n\t\t\t\tend\n\n\t\t\t\tfunction processQuery(query, source, options)\n   \t\t\t\t local resp, err = nsQL.query(query, source, options)\n   \t\t\t\t if(err ~= nil) then\n   \t\t\t\t     error(err)\n   \t\t\t\t end\n   \t\t\t\t return resp\n\t\t\t\tend\n\n\t\t\t\tfunction generateTable(table)\n \t\t\t\t   local out, err = nsOutput.table(table)\n \t\t\t\t   if(err ~= nil) then\n \t\t\t\t       error(err)\n \t\t\t\t   end\n  \t\t\t\t  return out\n\t\t\t\tend","output":{"lastExecution":"0001-01-01T00:00:00Z","state":"Unknown","results":{"type":"","content":null}},"options":{"showCode":true,"showOutput":true,"timeout":180,"mainFunction":"main","visualization":{"parameters":null},"status":"","showConfiguration":true}},{"id":"00691b35-7d89-4dd7-aac6-66b681737852","name":"Delete","language":"lua","code":"local nsQL = require(\"nsQL\")\n\n\t\t\t\tfunction main()\n    \t\t\t\tlocal query = [[\n \t\t\t\t       DELETE\n \t\t\t\t        FROM    nssim.sampledata\n \t\t\t\t       WHERE   rowid = `ba43698b-8ee3-44fe-9cbc-c66c75f7df59` and id='ba43698b-8ee3-44fe-9cbc-c66c75f7df59';\n \t\t\t\t   ]]\n \t\t\t\t   local source = {\n \t\t\t\t      Protocol = \"cassandra\",\n        \t\t\t  Host = \"cassandra1-dev2-northstar.mon-marathon-service.mesos,cassandra2-dev2-northstar.mon-marathon-service.mesos,cassandra3-dev2-northstar.mon-marathon-service.mesos,cassandra4-dev2-northstar.mon-marathon-service.mesos,cassandra5-dev2-northstar.mon-marathon-service.mesos\",\n  \t\t\t\t      Port = \"31814\",\n  \t\t\t\t      Backend = \"native\"\n  \t\t\t\t  }\n  \t\t\t\t  processQuery(query, source, {})\n\t\t\t\tend\n\n\t\t\t\tfunction processQuery(query, source, options)\n \t\t\t\t   local resp, err = nsQL.query(query, source, options)\n \t\t\t\t   if(err ~= nil) then\n \t\t\t\t       error(err)\n \t\t\t\t   end\n \t\t\t\t   return resp\n\t\t\t\tend","output":{"lastExecution":"0001-01-01T00:00:00Z","state":"Unknown","results":{"type":"","content":null}},"options":{"showCode":true,"showOutput":true,"timeout":180,"mainFunction":"main","visualization":{"parameters":null},"status":"","showConfiguration":true}}]}